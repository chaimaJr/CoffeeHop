<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Place Order</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  @if (loading) {
    <div style="display: flex; justify-content: center; margin: 2rem;">
      <ion-spinner name="crescent"></ion-spinner>
    </div>
  }

  @if (error) {
    <ion-card color="danger">
      <ion-card-content>{{ error }}</ion-card-content>
    </ion-card>
  }
  
  @if (!loading) { 
    <ng-container>
      <ion-card>
        <ion-card-header>
          <ion-card-title>1. Choose Your Coffee ‚òï</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-radio-group [(ngModel)]="selectedCoffee">
            <ion-list>
              <ion-item *ngFor="let coffee of coffees">
                <ion-radio [value]="coffee" (ionSelect)="selectCoffee(coffee)">
                  <div style="display: flex; flex-direction: column; padding-left: 12px;">
                    <strong>{{ coffee.title }}</strong>
                    <span style="color: #666; font-size: 0.9rem;">{{ coffee.description }}</span>
                    <span style="color: #667eea; font-weight: bold; margin-top: 4px;">${{ coffee.price }}</span>
                  </div>
                </ion-radio>
              </ion-item>
            </ion-list>
          </ion-radio-group>

          <p *ngIf="coffees.length === 0" style="color: #999; text-align: center; padding: 1rem;">
            No coffees available
          </p>
        </ion-card-content>
      </ion-card>

      <ion-card *ngIf="desserts.length > 0">
        <ion-card-header>
          <ion-card-title>3. Add Desserts (Optional) üç∞</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item *ngFor="let dessert of desserts">
              <ion-checkbox 
                [checked]="isDessertSelected(dessert)"
                (ionChange)="toggleDessert(dessert)">
                <div style="display: flex; justify-content: space-between; width: 100%; padding-left: 12px;">
                  <div>
                    <strong>{{ dessert.title }}</strong>
                    <p style="margin: 0; color: #666; font-size: 0.9rem;">{{ dessert.description }}</p>
                  </div>
                  <span style="color: #667eea; font-weight: bold;">${{ dessert.price }}</span>
                </div>
              </ion-checkbox>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>

      <ion-card>
        <ion-card-header>
          <ion-card-title>4. Quantity & Notes</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-item>
            <ion-label>Quantity</ion-label>
            <ion-input 
              type="number" 
              [(ngModel)]="quantity" 
              min="1"
              max="10"
              inputmode="numeric">
            </ion-input>
          </ion-item>

          <ion-item>
            <ion-label position="floating">Special Instructions (Optional)</ion-label>
            <ion-textarea 
              [(ngModel)]="notes" 
              rows="3"
              placeholder="e.g., Extra hot, no sugar, almond milk">
            </ion-textarea>
          </ion-item>
        </ion-card-content>
      </ion-card>

      <ion-card *ngIf="selectedCoffee">
        <ion-card-header>
          <ion-card-title>Order Summary</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div style="display: flex; flex-direction: column; gap: 8px;">
            <div style="display: flex; justify-content: space-between;">
              <span>‚òï {{ selectedCoffee.title }}</span>
              <span>${{ selectedCoffee.price }}</span>
            </div>

            <div *ngFor="let dessert of selectedDesserts" style="display: flex; justify-content: space-between; color: #666;">
              <span>üç∞ {{ dessert.title }}</span>
              <span>${{ dessert.price }}</span>
            </div>

            <div style="display: flex; justify-content: space-between; color: #666; margin-top: 8px;">
              <span>Quantity</span>
              <span>√ó {{ quantity }}</span>
            </div>

            <div style="border-top: 2px solid #ddd; margin-top: 8px; padding-top: 8px; display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold; color: #667eea;">
              <span>Total</span>
              <span>${{ totalPrice.toFixed(2) }}</span>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <div style="display: flex; gap: 12px; margin-top: 1rem; margin-bottom: 2rem;">
        <ion-button 
          expand="block" 
          fill="outline"
          [disabled]="submitting"
          (click)="resetOrder()"
          style="flex: 1;">
          Reset
        </ion-button>
        
        <ion-button 
          expand="block" 
          color="primary"
          [disabled]="!canPlaceOrder || submitting"
          (click)="placeOrder()"
          style="flex: 2;">
          <ion-spinner *ngIf="submitting" name="crescent" style="margin-right: 8px;"></ion-spinner>
          {{ submitting ? 'Placing...' : 'Place Order' }}
        </ion-button>
      </div>
    </ng-container>
  }
</ion-content>