<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>Checkout</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <ion-card>
    <ion-card-header>
      <ion-card-title>Order Summary</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div *ngFor="let item of cartItems" style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
        <span>{{ item.quantity }}x {{ item.menuItem.title }}</span>
        <span>${{ (item.menuItem.price * item.quantity).toFixed(2) }}</span>
      </div>
      <br>
      <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1rem;">
        <span>Total:</span>
        <span>${{ total().toFixed(2) }}</span>
      </div>
    </ion-card-content>
  </ion-card>

  <ion-item style="margin-top: 2rem;">
    <ion-label position="floating">Special Instructions (optional)</ion-label>
    <ion-textarea 
      [(ngModel)]="notes" 
      placeholder="Any special requests?"
      [disabled]="loading">
    </ion-textarea>
  </ion-item>

  <ion-item>
    <ion-label>Schedule for later?</ion-label>
    <ion-toggle 
      [(ngModel)]="isScheduled"
      [disabled]="loading">
    </ion-toggle>
  </ion-item>

  <ion-item *ngIf="isScheduled">
    <ion-label position="floating">Pickup Time</ion-label>
    <ion-datetime 
      [(ngModel)]="scheduledTime"
      [disabled]="loading">
    </ion-datetime>
  </ion-item>

  <ion-button 
    expand="block" 
    color="primary" 
    size="large" 
    style="margin-top: 2rem;" 
    (click)="placeOrder()" 
    [disabled]="loading || cartItems.length === 0">
    <ion-spinner *ngIf="loading" name="crescent" style="margin-right: 0.5rem;"></ion-spinner>
    {{ loading ? 'Processing...' : 'PLACE ORDER' }}
  </ion-button>

  <ion-button 
    expand="block" 
    color="light" 
    (click)="goBack()"
    [disabled]="loading">
    BACK TO MENU
  </ion-button>

  <ion-toast 
    [isOpen]="success" 
    message="Order placed successfully! ðŸŽ‰" 
    color="success" 
    duration="2000">
  </ion-toast>

  <ion-toast 
    [isOpen]="!!error" 
    [message]="error || ''" 
    color="danger" 
    duration="3000" 
    (didDismiss)="error = null">
  </ion-toast>
</ion-content>